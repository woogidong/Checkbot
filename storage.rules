rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // ============================================
    // 관리자 UID 설정
    // ============================================
    // Firestore 규칙과 동일한 관리자 UID를 사용하세요.
    // Firebase 콘솔 > Authentication > Users에서 UID를 확인할 수 있습니다.
    function isAdmin() {
      return request.auth != null && 
             request.auth.uid in [
               'YOUR_ADMIN_UID_1',  // ⚠️ 여기에 관리자 UID를 입력하세요 (Firestore와 동일)
               'YOUR_ADMIN_UID_2'   // 필요시 여러 명 추가 가능
             ];
    }
    
    // ============================================
    // 좌석 사용 관련 파일 저장 경로
    // ============================================
    // 경로 예시: seat-usage/{userId}/{date}/{filename}
    // 예: seat-usage/abc123/2024-01-15/seat-log.json
    match /seat-usage/{userId}/{allPaths=**} {
      // 읽기 규칙:
      // 1. 모든 사람이 읽을 수 있음 (로그인 여부 무관)
      //    → 현재 좌석 이용 현황 관련 파일을 누구나 볼 수 있음
      // 2. 관리자는 모든 파일을 읽을 수 있음 (이미 위에서 허용됨)
      allow read: if true;
      
      // 쓰기 규칙:
      // - Google 로그인한 사용자는 자신의 폴더에만 파일을 업로드할 수 있음
      // - 본인의 userId 경로에만 파일 저장 가능
      allow write: if request.auth != null && request.auth.uid == userId;
      
      // 삭제 규칙:
      // - 관리자만 삭제 가능
      // - 필요 시 잘못된 파일을 삭제할 수 있음
      allow delete: if isAdmin();
    }
    
    // ============================================
    // 사용자별 일반 파일 저장 경로
    // ============================================
    // 경로 예시: users/{userId}/{filename}
    // 사용자 개인 파일을 저장하는 경우 사용
    match /users/{userId}/{allPaths=**} {
      // 읽기: 본인 또는 관리자만 가능
      allow read: if request.auth != null && 
                     (request.auth.uid == userId || isAdmin());
      
      // 쓰기: 본인만 가능
      allow write: if request.auth != null && request.auth.uid == userId;
      
      // 삭제: 관리자만 가능
      allow delete: if isAdmin();
    }
    
    // ============================================
    // 기타 경로 접근 제한
    // ============================================
    // 위에서 명시하지 않은 모든 경로는 접근 불가
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
