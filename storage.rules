rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // 관리자 UID 목록 (Firestore 규칙과 동일하게 설정)
    function isAdmin() {
      return request.auth != null && 
             request.auth.uid in [
               'YOUR_ADMIN_UID_1',  // 여기에 관리자 UID를 입력하세요
               'YOUR_ADMIN_UID_2'   // 여러 명의 관리자를 추가할 수 있습니다
             ];
    }
    
    // 좌석 사용 관련 파일 저장 경로
    // 예: seat-usage/{userId}/{date}/{filename}
    match /seat-usage/{userId}/{allPaths=**} {
      // 읽기: 모든 사람이 가능 (로그인 여부 무관)
      // - 현재 좌석 이용 현황 관련 파일을 누구나 볼 수 있음
      allow read: if true;
      
      // 쓰기: 로그인한 사용자만 가능
      // - Google 로그인한 사용자는 자신의 좌석 사용 관련 파일을 업로드할 수 있음
      allow write: if request.auth != null && request.auth.uid == userId;
      
      // 삭제: 관리자만 가능
      allow delete: if isAdmin();
    }
    
    // 사용자별 파일 저장 경로
    match /users/{userId}/{allPaths=**} {
      // 읽기: 본인 또는 관리자만 가능
      allow read: if request.auth != null && 
                     (request.auth.uid == userId || isAdmin());
      
      // 쓰기: 본인만 가능
      allow write: if request.auth != null && request.auth.uid == userId;
      
      // 삭제: 관리자만 가능
      allow delete: if isAdmin();
    }
    
    // 기타 경로는 기본적으로 거부
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
